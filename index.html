<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <script type="application/javascript">

        async function refreshStations() {
            let response = await fetch("http://localhost:8080/stations")
            let stations = await response.json()
         
            for (let i = 0; i < stations.length; i++) {

                let tr = document.createElement("tr");
                let tdId = document.createElement("td");
                let tdAddres = document.createElement("td");
                let tdStatus = document.createElement("td");
                let tdDelete = document.createElement("button");

                tdId.innerText = stations[i].id
                tdAddres.innerText = stations[i].addres
                tdStatus.innerText = stations[i].status 
                tdDelete.onclick = function() {
                    deleteStations(stations[i].id)
                } 

                tr.appendChild(tdId)
                tr.appendChild(tdAddres)
                tr.appendChild(tdStatus)
                tr.appendChild(tdDelete)

                var table = document.getElementById("table");
                table.appendChild(tr);
            }   
        }

        function deleteStations(id) {
            let response = fetch('http://localhost:8080/stations/'+ id, {
                method: "Delete",
            })
        }

        function createNewStation(stations) {
            const form = document.getElementById("newStation")
            const formData = new FormData(form);
            let resp = {}
            for (let [k, v] of formData.entries()) { 
                resp[k] = v; 
            }
            alert(formData.entries())
/*            formData.append('idNew', stations.id);
            formData.append('addresNew', stations.addres);
            formData.append('statusNew', stations.status);*/

            fetch("http://localhost:8080/stations", {
                method: "POST",
                //mode: 'cors',
//                origin: 'localhost',
                
                headers: {'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*'}, 
                body: JSON.stringify(resp)
            }).then(res => {
                console.log("Request complete! response:", res);
            });

            // return fetch('http://localhost:8080/stations', {
            //     method: 'POST',
            //     body: formData
            // }).then(response => response.json())
        }
        

    </script>
</head>
<body>

    <button onclick="refreshStations()">Add station</button> 

    <button onclick="createNewStation()">New station</button> 

    <table id = "table">
        <tr>
            <th>Id</th>
            <th>Addres</th>
            <th>Status</th>
            <th>Delete</th>
        </tr>
    </table>

    <form id="newStation" action="form" method="post">
        <input id="idNew" type="number" name="Id">
        <input id="addresNew" type="text" name="Addres">
        <input id="statusNew" type="text" name="Status">
    </form>

</body>
</html>